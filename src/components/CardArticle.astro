---
interface Props {
    title: string
    description: string
    published: Date
    url: string
    image?: string
    tags?: string[]
    readingTime?: number
    readingChars?: number
}
const { title, description, published, url, image, tags = [], readingTime, readingChars, ...rest } = Astro.props

import { Icon } from 'astro-icon/components'

const formatDate = (date: Date) => {
    const value = new Date(date)
    const year = value.getFullYear()
    const month = String(value.getMonth() + 1).padStart(2, '0')
    const day = String(value.getDate()).padStart(2, '0')
    return year + '-' + month + '-' + day
}
---

<a href={url} class="r-card" {...rest}>
    {image && <img class="r-cover" src={image} alt={title} />}
    <!-- 文章概要 -->
    <div class="r-item">
        <!-- 上半部分 标题&描述 -->
        <div class="r-summary">
            <!-- 标题 -->
            <div class="r-catalog">
                {title}<Icon name="mdi:navigate-next" width={36} height={36} class="r-icon" />
            </div>
            <!-- 描述 -->
            <div class="r-description">{description}</div>
        </div>

        <div class="r-grow"></div>

        <!-- 下半部分 文章信息 -->
        <div class="r-footer">
            <div class="r-info">
                <span>
                    <Icon name="mdi:calendar-blank-outline" width={18} height={18} />
                    {formatDate(published)}
                </span>
                <span>
                    <Icon name="mdi:clock-outline" width={18} height={18} />
                    {readingTime} 分钟</span
                >
                <span>
                    <Icon name="mdi:pencil-outline" width={18} height={18} />
                    {readingChars} 字</span
                >
            </div>
            {
                tags.length > 0 && (
                    <div class="r-tags">
                        {tags.map((tag) => (
                            <span class="r-tag">#{tag}</span>
                        ))}
                    </div>
                )
            }
        </div>
    </div>
</a>

<style lang="less">
    @import url('@/styles/variables.less');
    .r-card {
        display: block;
        margin: 0 @layout-content-padding;
        padding: 20px 0;
        min-height: @layout-index-card-min-height;
        border-bottom: 1px solid @color-border;
        position: relative;

        &[data-index]:first-child {
            padding-top: (20px + 8px); // 8px 见 resetCustom 的垂直 padding
            .r-cover {
                border-top-right-radius: @layout-content-border-radius;
            }
        }
        &:last-child {
            padding-bottom: (20px + 8px);
            border-bottom: none;
            .r-cover {
                border-bottom-right-radius: @layout-content-border-radius;
            }
        }

        // 整个 .card 都被 hover 时都可以触发
        &:hover {
            .r-catalog {
                color: @color-theme;
            }
            .r-icon {
                opacity: 1;
                transform: translateX(4px);
            }
        }

        // 如果存在封面，那么底部分两行靠左显示
        &:has(.r-cover) {
            margin-right: 0;
            padding-right: @layout-content-padding;
            // .r-footer {
            //     flex-direction: column;
            //     align-items: flex-start;
            // }
            // .r-tags {
            //     gap: 6px;
            // }
        }
    }

    // 封面
    .r-cover {
        position: absolute;
        top: 0;
        right: 0;
        z-index: -1;
        width: @layout-index-card-cover-width;
        height: 100%;
        object-fit: cover;
        mask-image: linear-gradient(to right, transparent, #000);
    }

    .r-item {
        display: flex;
        flex-direction: column;
        min-height: (@layout-index-card-min-height - 20px * 2);
    }

    // 标题
    .r-catalog {
        display: flex;
        align-items: center;
        font-weight: 600;
        font-size: 24px;
        transition: all @anim-duration ease;

        .r-icon {
            opacity: 0;
            transform: translateX(-4px);
            transition: all @anim-duration ease;
        }
    }

    // 描述
    .r-description {
        margin: 8px 0;
    }

    .r-footer {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
        font-size: 0.9rem;
        color: @color-secondary;

        .r-info {
            display: flex;
            flex-direction: row;
            gap: 1.5em;

            span {
                display: flex;
                align-items: center;
                gap: 4px;
            }
        }
    }

    .r-tags {
        display: flex;
        gap: 0.75em;
        flex-wrap: wrap;

        .r-tag {
            background-color: @color-theme-light;
            color: @color-theme-dark;
            padding: 3px 9px;
            border-radius: 4px;
            font-size: 14px;
        }
    }
</style>

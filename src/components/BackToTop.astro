---
import { Icon } from 'astro-icon/components'
---

<div id="back-to-top" class="r-back-to-top">
    <Icon name="mdi:arrow-up" width={32} height={32} />
</div>

<script>
    const THRESHOLD = 240

    const initBackToTop = () => {
        const btn = document.getElementById('back-to-top')
        if (!btn) return
        // 更新页面位置状态
        const update = () => {
            const visible = window.scrollY > THRESHOLD
            btn.classList.toggle('active', visible)
        }

        // 避免重复绑定
        if (!btn.dataset.bound) {
            btn.addEventListener('click', () => {
                try {
                    window.scrollTo({ top: 0, behavior: 'smooth' })
                } catch {
                    window.scrollTo(0, 0)
                }
            })
            btn.dataset.bound = '1'
        }

        update()
        window.addEventListener('scroll', update, { passive: true })
    }

    initBackToTop()
    document.addEventListener('astro:after-swap', initBackToTop)
</script>

<style lang="less">
    @import url('@/styles/variables.less');

    .r-back-to-top {
        position: fixed;
        right: 36px;
        bottom: 128px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background-color: #fff;
        color: @color-theme-dark;
        opacity: 0;
        transform: translateY(8px);
        transition: all @anim-duration ease;
        z-index: 200;
    }
    .r-back-to-top.active {
        opacity: 1;
        transform: translateY(0);
    }
    .r-back-to-top:hover {
        background-color: lighten(@color-theme-light, 3%);
        // background-color: @color-theme;
    }
    .r-back-to-top:active {
        transform: scale(.9);
        background-color: darken(@color-bg, 10%);
    }

    @media (prefers-reduced-motion: reduce) {
        .r-back-to-top {
            transition: none;
        }
    }
</style>

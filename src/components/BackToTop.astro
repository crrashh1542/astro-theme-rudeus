---
import { Icon } from 'astro-icon/components'
---

<div id="back-to-top" class="r-back-to-top">
    <Icon name="mdi:arrow-up" width={28} height={28} />
</div>

<script>
    const THRESHOLD = 240

    function initBackToTop() {
        const btn = document.getElementById('back-to-top')
        const update = () => {
            const visible = window.scrollY > THRESHOLD
            btn.classList.toggle('is-visible', visible)
        }

        // 避免重复绑定
        if (!btn.dataset.bound) {
            btn.addEventListener('click', () => {
                try {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } catch {
                    window.scrollTo(0, 0)
                }
            });
            btn.dataset.bound = '1'
        }

        update()
        window.addEventListener('scroll', update, { passive: true })
    }

    initBackToTop()
    document.addEventListener('astro:after-swap', initBackToTop)
</script>

<style lang="less">
    @import url('@/styles/variables.less');

    .r-back-to-top {
        position: fixed;
        right: 36px;
        bottom: 96px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: @color-theme;
        color: @color-bg;
        opacity: 0;
        transform: translateY(8px);
        transition: all .2s ease;
        z-index: 200;
    }

    .r-back-to-top.is-visible {
        opacity: 1;
        transform: translateY(0);
    }

    @media (prefers-reduced-motion: reduce) {
        .r-back-to-top {
            transition: none;
        }
    }
</style>

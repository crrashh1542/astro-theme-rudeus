---
import { getCollection } from 'astro:content'
import { analyzeReading } from '@/utils/readingStat'
import { genDescription } from '@/utils/genDescription'

import MainLayout from '@/layouts/MainLayout.astro'
import CardArticle from '@/components/CardArticle.astro'

const posts = (await getCollection('archives')).sort(
    (a, b) => b.data.published.valueOf() - a.data.published.valueOf()
)
---

<MainLayout title="云萧的咕咕屋 - 可能有好东西哦 (*σ´∀`)σ" description="以万象之不息，致不息之万象">
    <div class="r-content">
        {
            posts.map((post) => {
                const stats = analyzeReading(post.body)
                const description = post.data.description?.trim() || genDescription(post.body)
                return (
                    <CardArticle
                        title={post.data.title}
                        description={description}
                        published={post.data.published}
                        url={`/archives/${post.slug}.html`}
                        tags={post.data.tags}
                        readingTime={stats.minutes}
                        readingChars={stats.estimatedChars}
                        image={post.data.image}
                        data-index
                    />
                )
            })
        }
    </div>
</MainLayout>

<style lang="less">
    .r-content {
        padding: 0;
    }
</style>
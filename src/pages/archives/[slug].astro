---
import { getCollection } from 'astro:content'
import BlogPostLayout from '@/layouts/BlogPostLayout.astro'

export async function getStaticPaths() {
    const posts = await getCollection('archives')
    return posts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }))
}

const { post } = Astro.props
const { Content } = await post.render()

const ordered = (await getCollection('archives')).sort(
    (a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
)
const index = ordered.findIndex((p) => p.slug == post.slug)
const prev = index > 0 ? ordered[index - 1] : null
const next = index >= 0 && index < ordered.length - 1 ? ordered[index + 1] : null
---

<BlogPostLayout post={post} prev={prev} next={next}>
    <Content />
</BlogPostLayout>
